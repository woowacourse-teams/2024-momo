name: ë¦¬ë·° ìƒì„± ì‹œ, ë””ìŠ¤ì½”ë“œ ì•Œë¦¼

on:
  pull_request_review:
    types: [submitted]

env:
  hwinkr: "@í•´ë¦¬"
  Yoonkyoungme: "@ë¹™ë´‰"
  hw0603: "@í˜ë“œë¡œ"
  ikjo39: "@ë‹¤ì˜¨"
  ehBeak: "@ë°°í‚¤"
  seokmyungham: "@ì¬ì¦ˆ"
  Largopie: "@ë‚™íƒ€"
  seunghye218: "@ë§ˆí¬"

jobs:
  notify_changes_requested:
    if: github.event_name == 'pull_request_review' && github.event.review.state == 'CHANGES_REQUESTED'
    runs-on: ubuntu-latest

    steps:
      - name: ëª¨ë“  íŒ€ì›ì´ í™•ì¸í•´ì•¼ í•˜ëŠ” PRì— ë¦¬ë·°(CHANGES_REQUESTED)ê°€ ë“±ë¡ë˜ë©´ FE, BE ë‘ ì±„ë„ ëª¨ë‘ ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[ALL]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"

          ASSIGNEES=$(jq -r '.pull_request.assignees | map(.login) | join(" ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=""
          for ASSIGNEE in $ASSIGNEES; do
            MENTION=$(printenv $ASSIGNEE)
            if [ -z "$MENTION" ]; then
              MENTION=$ASSIGNEE
            fi
            ASSIGNEE_MENTIONS="${ASSIGNEE_MENTIONS}[${MENTION}](https://github.com/${ASSIGNEE}) "
          done

          COMMENT_BODY=$(jq -r '.review.body' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸš¨ ${REVIEWER_LINK}ë‹˜ì´ ë³€ê²½ì„ ìš”ì²­í–ˆì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“‚ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ìš”ì²­ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $FE_DISCORD_WEBHOOK_URL

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸš¨ ${REVIEWER_LINK}ë‹˜ì´ ë³€ê²½ì„ ìš”ì²­í–ˆì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“‚ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ìš”ì²­ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $BE_DISCORD_WEBHOOK_URLL

      - name: í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë·°(CHANGES_REQUESTED)ê°€ ë“±ë¡ë˜ë©´ í”„ë¡ íŠ¸ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[FE]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"

          ASSIGNEES=$(jq -r '.pull_request.assignees | map(.login) | join(" ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=""
          for ASSIGNEE in $ASSIGNEES; do
            MENTION=$(printenv $ASSIGNEE)
            if [ -z "$MENTION" ]; then
              MENTION=$ASSIGNEE
            fi
            ASSIGNEE_MENTIONS="${ASSIGNEE_MENTIONS}[${MENTION}](https://github.com/${ASSIGNEE}) "
          done

          COMMENT_BODY=$(jq -r '.review.body' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸš¨ ${REVIEWER_LINK}ë‹˜ì´ ë³€ê²½ì„ ìš”ì²­í–ˆì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“‚ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ìš”ì²­ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $FE_DISCORD_WEBHOOK_URL

      - name: ë°±ì—”ë“œ ë¦¬ë·°(CHANGES_REQUESTED)ê°€ ë“±ë¡ë˜ë©´ ë°±ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[BE]')
        env:
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"

          ASSIGNEES=$(jq -r '.pull_request.assignees | map(.login) | join(" ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=""
          for ASSIGNEE in $ASSIGNEES; do
            MENTION=$(printenv $ASSIGNEE)
            if [ -z "$MENTION" ]; then
              MENTION=$ASSIGNEE
            fi
            ASSIGNEE_MENTIONS="${ASSIGNEE_MENTIONS}[${MENTION}](https://github.com/${ASSIGNEE}) "
          done

          COMMENT_BODY=$(jq -r '.review.body' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸš¨ ${REVIEWER_LINK}ë‹˜ì´ ë³€ê²½ì„ ìš”ì²­í–ˆì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“‚ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ìš”ì²­ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $BE_DISCORD_WEBHOOK_URL

  notify_commented:
    if: github.event_name == 'pull_request_review' && github.event.review.state == 'COMMENTED'
    runs-on: ubuntu-latest

    steps:
      - name: ëª¨ë“  íŒ€ì›ì´ í™•ì¸í•´ì•¼ í•˜ëŠ” PRì— ë¦¬ë·°(COMMENTED)ê°€ ë“±ë¡ë˜ë©´ FE, BE ë‘ ì±„ë„ ëª¨ë‘ ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[ALL]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"

          ASSIGNEES=$(jq -r '.pull_request.assignees | map(.login) | join(" ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=""
          for ASSIGNEE in $ASSIGNEES; do
            MENTION=$(printenv $ASSIGNEE)
            if [ -z "$MENTION" ]; then
              MENTION=$ASSIGNEE
            fi
            ASSIGNEE_MENTIONS="${ASSIGNEE_MENTIONS}[${MENTION}](https://github.com/${ASSIGNEE}) "
          done

          COMMENT_BODY=$(jq -r '.review.body' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸ’¬ ${REVIEWER_LINK}ë‹˜ì´ ìƒˆë¡œìš´ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¼ì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“„ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ì½”ë©˜íŠ¸ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $FE_DISCORD_WEBHOOK_URL

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸ’¬ ${REVIEWER_LINK}ë‹˜ì´ ìƒˆë¡œìš´ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¼ì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“„ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ì½”ë©˜íŠ¸ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $BE_DISCORD_WEBHOOK_URL

      - name: í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë·°(COMMENTED)ê°€ ë“±ë¡ë˜ë©´ í”„ë¡ íŠ¸ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[FE]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"

          ASSIGNEES=$(jq -r '.pull_request.assignees | map(.login) | join(" ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=""
          for ASSIGNEE in $ASSIGNEES; do
            MENTION=$(printenv $ASSIGNEE)
            if [ -z "$MENTION" ]; then
              MENTION=$ASSIGNEE
            fi
            ASSIGNEE_MENTIONS="${ASSIGNEE_MENTIONS}[${MENTION}](https://github.com/${ASSIGNEE}) "
          done

          COMMENT_BODY=$(jq -r '.review.body' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸ’¬ ${REVIEWER_LINK}ë‹˜ì´ ìƒˆë¡œìš´ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¼ì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“„ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ì½”ë©˜íŠ¸ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $FE_DISCORD_WEBHOOK_URL

      - name: ë°±ì—”ë“œ ë¦¬ë·°(COMMENTED)ê°€ ë“±ë¡ë˜ë©´ ë°±ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[BE]')
        env:
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"

          ASSIGNEES=$(jq -r '.pull_request.assignees | map(.login) | join(" ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=""
          for ASSIGNEE in $ASSIGNEES; do
            MENTION=$(printenv $ASSIGNEE)
            if [ -z "$MENTION" ]; then
              MENTION=$ASSIGNEE
            fi
            ASSIGNEE_MENTIONS="${ASSIGNEE_MENTIONS}[${MENTION}](https://github.com/${ASSIGNEE}) "
          done

          COMMENT_BODY=$(jq -r '.review.body' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ“± ${ASSIGNEE_MENTIONS}\nğŸ’¬ ${REVIEWER_LINK}ë‹˜ì´ ìƒˆë¡œìš´ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¼ì–´ìš”!\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“„ **ì œëª©**: ${{ github.event.pull_request.title }}\nğŸ“ **ì½”ë©˜íŠ¸ ë‚´ìš©**: ${COMMENT_BODY}\"}" \
          $BE_DISCORD_WEBHOOK_URL
