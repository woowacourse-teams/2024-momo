name: ê¹ƒí—ˆë¸Œ ì´ìŠˆ ìƒì„± ì‹œ, ë””ìŠ¤ì½”ë“œ ì•Œë¦¼

on:
  issues:
    types: [opened, reopened]

env:
  hwinkr: "@í•´ë¦¬"
  Yoonkyoungme: "@ë¹™ë´‰"
  hw0603: "@í˜ë“œë¡œ"
  ikjo39: "@ë‹¤ì˜¨"
  ehBeak: "@ë°°í‚¤"
  seokmyungham: "@ì¬ì¦ˆ"
  Largopie: "@ë‚™íƒ€"
  seunghye218: "@ë§ˆí¬"

jobs:
  notify_issue:
    if: github.event.issue
    runs-on: ubuntu-latest

    steps:
      - name: ì „ì²´ ì´ìŠˆê°€ ë“±ë¡ë˜ë©´ FE, BE ë‘ ì±„ë„ ëª¨ë‘ ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.issue.title, '[ALL]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          LABELS=$(jq -r '.issue.labels | map(.name) | join(", ")' < $GITHUB_EVENT_PATH)

          ASSIGNEE_LINKS=$(jq -r '.issue.assignees | map("[\(.login)](https://github.com/\(.login))") | join(", ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=$(jq -r '.issue.assignees | map(env[.login] // .login) | join(", ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTION_LINKS=$(jq -r '.issue.assignees | map("[\((env[.login] // .login))](https://github.com/\(.login))") | join(", ")' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ€ **ìƒˆë¡œìš´ ì „ì²´ ì´ìŠˆê°€ ë“±ë¡ë˜ì—ˆì–´ìš”!** ğŸ§š: ${{ github.event.issue.html_url }}\nğŸ“‚ **ì œëª©**: ${{ github.event.issue.title }}\nğŸ•º **ë‹´ë‹¹ í¬ë£¨**: ${ASSIGNEE_MENTION_LINKS}\nğŸ”‘ **ì—…ë¬´ í‚¤ì›Œë“œ**: ${LABELS}\"}" \
          $FE_DISCORD_WEBHOOK_URL

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ€ **ìƒˆë¡œìš´ ì „ì²´ ì´ìŠˆê°€ ë“±ë¡ë˜ì—ˆì–´ìš”!** ğŸ§š: ${{ github.event.issue.html_url }}\nğŸ“‚ **ì œëª©**: ${{ github.event.issue.title }}\nğŸ•º **ë‹´ë‹¹ í¬ë£¨**: ${ASSIGNEE_MENTION_LINKS}\nğŸ”‘ **ì—…ë¬´ í‚¤ì›Œë“œ**: ${LABELS}\"}" \
          $BE_DISCORD_WEBHOOK_URL

      - name: ìƒˆë¡œìš´ í”„ë¡ íŠ¸ì—”ë“œ ì´ìŠˆê°€ ë“±ë¡ë˜ë©´ í”„ë¡ íŠ¸ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.issue.title, '[FE]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
        run: |
          LABELS=$(jq -r '.issue.labels | map(.name) | join(", ")' < $GITHUB_EVENT_PATH)

          ASSIGNEE_LINKS=$(jq -r '.issue.assignees | map("[\(.login)](https://github.com/\(.login))") | join(", ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=$(jq -r '.issue.assignees | map(env[.login] // .login) | join(", ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTION_LINKS=$(jq -r '.issue.assignees | map("[\((env[.login] // .login))](https://github.com/\(.login))") | join(", ")' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ€ **ìƒˆë¡œìš´ ì´ìŠˆê°€ ë“±ë¡ë˜ì—ˆì–´ìš”!** ğŸ§š: ${{ github.event.issue.html_url }}\nğŸ“‚ **ì œëª©**: ${{ github.event.issue.title }}\nğŸ•º **ë‹´ë‹¹ í¬ë£¨**: ${ASSIGNEE_MENTION_LINKS}\nğŸ”‘ **ì—…ë¬´ í‚¤ì›Œë“œ**: ${LABELS}\"}" \
          $FE_DISCORD_WEBHOOK_URL

      - name: ìƒˆë¡œìš´ ë°±ì—”ë“œ ì´ìŠˆê°€ ë“±ë¡ë˜ë©´ ë°±ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.issue.title, '[BE]')
        env:
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          LABELS=$(jq -r '.issue.labels | map(.name) | join(", ")' < $GITHUB_EVENT_PATH)

          ASSIGNEE_LINKS=$(jq -r '.issue.assignees | map("[\(.login)](https://github.com/\(.login))") | join(", ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTIONS=$(jq -r '.issue.assignees | map(env[.login] // .login) | join(", ")' < $GITHUB_EVENT_PATH)
          ASSIGNEE_MENTION_LINKS=$(jq -r '.issue.assignees | map("[\((env[.login] // .login))](https://github.com/\(.login))") | join(", ")' < $GITHUB_EVENT_PATH)

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ€ **ìƒˆë¡œìš´ ì´ìŠˆê°€ ë“±ë¡ë˜ì—ˆì–´ìš”!** ğŸ§š: ${{ github.event.issue.html_url }}\nğŸ“‚ **ì œëª©**: ${{ github.event.issue.title }}\nğŸ•º **ë‹´ë‹¹ í¬ë£¨**: ${ASSIGNEE_MENTION_LINKS}\nğŸ”‘ **ì—…ë¬´ í‚¤ì›Œë“œ**: ${LABELS}\"}" \
          $BE_DISCORD_WEBHOOK_URL
